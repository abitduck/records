---
layout: post
title: shell编程之构建基本脚本
tags:
- LinuxOps
categories: linuxOps
description: shell编程之构建基本脚本
---

本章主要讨论编写脚本的基础知识。在开始编写自己的shell脚本大作之前，你必须知道这些基本概念。


<!-- more -->


## 1. 使用多个命令

到目前为止，你已经了解了如何使用shell的命令行界面提示符来输入命令和查看命令的结果了。shell脚本的关键在于输入多个命令并处理每个命令的结果，即使有可能将一个命令的结果传给另一个命令。shell允许你只用一步就将多个命令串联起来使用。

如果要两个命令一起运行，可在同一提示行输入它们，用分号分隔开：
{% highlight string %}
# date; who
Sat Apr 13 05:00:06 PDT 2019
ivan1001 tty7         2019-04-04 23:14 (:0)
root     pts/19       2019-04-12 20:34 (192.168.10.111)
{% endhighlight %}
恭喜你，你刚刚已经写了一个脚本了。这个简单的脚本只用到了两个bash shell命令。date命令先运行，显示了当前日期和时间；后面紧跟着who命令的输入，显示当前是谁登陆到了系统上。使用这种办法，你就能将任意多个命令串连在一起使用了，只要不超过最大命令行字符数255就行。

然而这种技术仅适用于小的脚本。它有一个致命的缺陷，即每次运行之前你都必须在命令提示符下输入整个命令。但不需要手动将这些命令都输入命令行中，你可以将命令合并成一个简单的文本文件。在需要运行这些命令时，你可以简单地运行这个文本文件。


## 2. 创建shell脚本文件

要将shell命令放到一个文本文件中，首先需要用一个文本编辑器来一个文件，然后将命令输入到文件中。

在创建shell脚本文件时，必须在文件的第一行指定要使用的shell。其格式为：
<pre>
#!/bin/bash
</pre>

在通常的shell脚本的行里，井号(#)用作注释行。shell脚本中的注释行是不被shell执行的。然而，shell脚本文件的第一行是个特例，井号后接叹号告诉shell用哪个shell来运行脚本（是的，你可以用bash shell来运行你的脚本程序，也可以用其他的shell）

在指定了shell之后，可以在文件的每行输入命令，后加一个回车符。之前提到过，注释可用井号添加。例如：
{% highlight string %}
#!/bin/bash

# This script displays the date and who's logged on
date
who
{% endhighlight %}
这就是所谓的脚本内容了。如有需要，可以用分号来在一行输入你想要的两个命令。但在shell脚本中，你可以用不同的行来列出命令。shell会根据命令在文件中出现的顺序来处理命令。

还有，要注意另有一行也以井号（#)开头，并添加了一个注释。以井号开头的行都不会被shell处理（除了以```#!```开头的第一行）。在脚本中留下注释来说明脚本做了什么，这种方法非常好，所以两年后会来再看这个脚本时，你还可以人容易记起来你做了什么。

将这个脚本保存在名为test1的文件中，就基本好了。在运行脚本前，还要做其他一些事。

现在运行脚本，如下结果可能会叫你有点失望：
<pre>
# test1
bash: test1: command not found
</pre>
你要跨过的第一个障碍是让bash shell能找到这个脚本文件。我们知道，shell会通过```PATH```环境变量来查找命令。快速的查看一下PATH环境变量就可以指出我们的问题了：
<pre>
# echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
</pre>

PATH环境变量被设成只在一组目录中查找命令。要让shell找到test1脚本，我们只需采取如下做法之一：

* 将shell脚本文件所处的目录添加到PATH环境变量中

* 在提示符中用绝对或相对文件路径来引用shell脚本文件

<pre>
提示： 有些Linux发行版将$HOME/bin目录添加进了PATH环境变量。它在每个用户的HOME目录下提供了
一个存放脚本文件的地方，shell可以在那里查找要执行的命令
</pre>

在这个例子中，我们将用第二种方式来告诉shell脚本文件所处的确切位置。记住，要引用当前目录下的文件，你要在shell中使用单点操作符：
<pre>
# ./test1
bash: ./test1: Permission denied
</pre>

现在shell已经可以找到脚本文件了，但还有一个问题。shell表明你还没有执行文件的权限。快速查看文件权限就找到问题所在：
<pre>
# ls -al test1
-rw-r--r-- 1 root root 74 Apr 13 07:59 test1
</pre>
在创建test1文件时，umask的值决定了新文件的默认权限设置。由于umas变量设成了022，系统创建的文件只有文件属主才有读写权限。

下一步是通过chmod命令赋予文件属主执行文件的权限：
<pre>
# chmod u+x ./test1
# ./test1
Sat Apr 13 08:03:10 PDT 2019
ivan1001 tty7         2019-04-04 23:14 (:0)
root     pts/19       2019-04-12 20:34 (192.168.10.111)
</pre>
成功了！ 现在万事具备，能够执行新的shell脚本文件了

## 3. 显示消息









<br />
<br />

**[参看]**






<br />
<br />
<br />


