---
layout: post
title: MySQL数据库备份与恢复
tags:
- database
categories: database
description: MySQL数据库备份与恢复
---


在MySQL运行过程中做好数据库备份是很重要的，因为在假如遇到系统崩溃、硬件损坏、用户误删数据的情况下，你就可以通过数据库备份来进行数据恢复。此外，在需要对数据库进行版本更新重新安装MySQL时，做好数据备份也是很有必要的； 在建立MySQL主从复制时也是需要进行数据库备份。

MySQL提供了很多的本分策略，你可以根据自身需要选择最合适的方法来进行备份。本章主要包括如下方面的内容：

* 备份类型： ```逻辑备份```与```物理备份```、```全量备份```与```增量备份```等

* 创建备份的方法

* 数据库恢复方法，包括恢复到某一个时间点

* 备份计划、压缩和加密

* 表的维护， 使能恢复损坏的表 


<!-- more -->

## 1. 备份与恢复类型

### 1.1 物理备份与逻辑备份

物理备份是指```拷贝存储数据库数据的目录与文件```。这种类型的备份适合于大型的、重要的数据库，并在遇到问题时需要能够快速的进行恢复。

逻辑备份只保存代表逻辑数据库结构（```CREATE DATABASE```, ```CREATE TABLE```语句）与内容（```INSERT```语句或```delimited-text```文件）的信息。这种类型的备份适合于数据量较小的情况，或者需要在不同架构的机器上重建数据这一情况。


**(1) 物理备份**

物理备份方法有如下一些特征：

* 备份需要拷贝```数据库目录```和```文件```。典型情况是需要拷贝整个或部分的MySQL数据目录

* 物理拷贝方法通常比逻辑拷贝更加快速，因为逻辑拷贝只涉及到文件拷贝，并不涉及相应的数据转换

* 输出也比逻辑备份更紧凑

* 因为对于繁忙的、重要的数据库来说，备份速度与紧凑性(compactness)是很重要的，因此一般MySQL企业版备份产品都是采用物理备份。

* 备份和恢复粒度的范围从```数据目录级别```到```文件级别```。取决于存储引擎，物理备份有可能不能提供```表级别```(table-level)粒度。例如，对于InnoDB表来说，可能是一个单独的文件，也可能与其他InnoDB表共享同一个存储文件；对于MyISAM表来说则对应于一系列的文件。

* 另外，对于数据库来说，备份可以包含任何相关联的文件，例如日志和配置文件

* 对于```MEMORY```表中的数据，并不能通过物理备份的方法来进行备份，这是因为```MEMORY```表数据根本不会存放在硬盘上。（MySQL企业版备份产品有相应的特性，可以将```MEMORY```表中的数据也进行备份）

* 物理备份只能够在那些具有相同或相似硬件特性的机器上移植

* 在MySQL服务器也可以进行物理备份。假如服务器正在运行，则需要进行适当的锁操作，使得在备份期间MySQL Server并不会改变数据库的内容。MySQL企业版备份产品能够在备份时对相应的表进行自动加锁。

* 物理备份的工具包括： MySQL Enterprise Backup提供的针对InnoDB表及其他类型表的```mysqlbackup```工具、文件系统级别的命令（比如cp、scp、tar、rsync),或者针对MyISAM表的```mysqlhotcopy```工具。


对于物理备份的```恢复```来说，主要有如下特征：

* MySQL Enterprise Backup直接提供了相应备份的恢复功能

* ndb_restore工具用于恢复NDB表

* 文件系统级别拷贝的文件，或者通过```mysqlhotcopy```工具拷贝的文件，都可以通过文件系统相应的命令拷贝回原来的地方。

<br />

**(2) 逻辑备份**

逻辑备份方法主要有如下特性：

* 是通过查询MySQL Server来获得数据库结构和内容相关的信息

* 逻辑备份比物理备份慢，这是因为必须要通过访问数据库来获得相应的信息，然后再将这些信息转换成相应的逻辑格式。假设输出是需要写到client一侧，那么MySQL Server还需要将这些信息返回给备份程序；

* 输出比物理备份更大，特别是当被保存为文本文件的时候

* 备份和恢复的粒度可以是server级别（all databases)、数据库级别（all tables in a particular database)、或者表级别。与存储引擎无关

* 备份并不包含日志和配置文件，也不包含其他一些与数据库相关的文件

* 备份是以逻辑结构来存储的，因此不依赖于特定的机器，具有高可移植性

* 逻辑备份需要在MySQL Server运行的情况下进行。MySQL Server不能处于offline状态

* 逻辑备份的工具包括```mysqldump```程序以及```SELECT ... INTO OUTFILE```语句。这对MySQL的任何存储引擎来说都适用，甚至是```MEMORY```表

* 对于恢复逻辑备份来说，SQL格式的dump文件可以直接有```mysql``` client进行处理。如果要加载```delimited-text```文件，使用```LOAD DATA INFILE```语句或者```mysqlimport```客户端即可。







<br />
<br />
**[参看]**:

1. [学会用各种姿势备份MySQL数据库](http://www.cnblogs.com/liangshaoye/p/5464794.html)



<br />
<br />
<br />

