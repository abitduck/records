---
layout: post
title: mysql数据库基础（八）
tags:
- database
categories: database
description: mysql数据库基础
---


复制使得一个MySQL server(master)的数据可以被复制到一个或多个其他的MySQL Server中（slave)。复制默认情况下是异步进行的，因此从服务器(Slaves)不需要永久的连接上主服务器(master)以接受更新。依据相应的配置，你可以复制所有的数据库，也可以复制所指定的数据库，甚至是指定数据库中的某一个表。使用MySQL主从复制有如下优势：

* 集群化解决方案 -- 可以将负载分摊到众多的从服务器以提高性能。在这样的环境下，所有的写操作和更新操作都必须在主服务器上，而读一般在一个或多个从服务器上。

* 提高数据的安全性 -- 因为数据会被复制到从服务器上，并且从服务器可以暂停复制进程，然后我们就可以在不中断主服务器的情况下对从服务器执行```backup```操作。


* 统计分析 --- 即时的数据可以在主服务器上被创建，我们可以在从服务器上对数据进行分析而并不影响主服务器(master)的性能

* 远距离数据分发 

MySQL的复制特性允许支持单向的异步复制： 一个MySQL Server作为主服务器，另外可以有一个或多个作为从服务器。这与```NDB集群```的同步复制是相反的。

可以有很多种方式来建立两个服务器之间的同步，但是最好的方式取决于数据的呈现方式以及所使用的存储引擎。有两种核心的复制格式： 一种是Statement Based Replication(SBR)，会复制整个SQL语句； 另一种是Row Based Replication(RBR),只会复制所改变的数据行。当然你可以可以使用第三种方式：Mixed Based Replication(MBR)。关于不同的复制模式，我们后面会再进行详细介绍。

从MySQL5.6.5版本起，支持基于全局事务标识(Global Transaction identifiers, GTIDs)的```事务复制```。当使用这种类型复制的时候，并不需要直接的使用日志文件，这极大的简化了很多常见的复制任务。因为采用```GTIDs```复制本身就是事务性质的，提交到master上的事务会同步应用到slave上。



<!-- more -->

## 1. MySQL复制的配置
MySQL不同服务器之间的复制是基于二进制日志（binary logging)机制来完成的。MySQL master实例将对数据的更新和修改作为```events```写入到二进制日志文件中。该二进制日志文件根据数据库记录到的修改以不同的日志格式来进行存储。MySQL从服务器会被配置为从Master读取二进制日志文件，然后在本地执行该日志文件所记录的数据库操作事件。

在本场景下，MySQL master处于```dumb```状态。一旦binary logging功能启用后，所有的语句都会记录到二进制日志文件中。每一个slave都会接受master日志的一份完整拷贝，由从服务器决定需要执行日志中的哪些事件。假如从服务器没有进行配置的话，则二进制日志文件中的所有事件均会在Slave上执行。假如有需要，你可以配置slave只执行某些数据库或表上的事件（注： 对于master服务器，所有的日志均会被记录，并不能选择只记录其中的某一些）。

每一个Slave都会记录当前所读日志文件的信息： 所读日志文件的名称、以及读取偏移量。这就意味着可以有多个从服务器同时连接到master，然后执行该日志文件中的不同部分。因为是由从服务器控制着读取进程，因此不同的slave服务器连接上master或者断开与master的连接均不会影响master服务器的操作。

在进行master-slave MySQL服务器配置时，每一个服务器都必须要有一个唯一ID(通过```server-id```选项来进行配置），另外每一个从服务器都必须配置master服务器的host name，日志文件名称，以及日志文件偏移量。这可以在Slave机器上通过```CHANGE MASTER TO```来进行修改。配置完成后相应的配置信息会被记录到slave的相应目录，这可能是一个文件或一个数据表。


本节我们主要会介绍```如何建立和配置MySQL复制所需要的环境```,包括创建一个新的复制环境的step-by-step操作指令。主要包括以下内容：

* MySQL主从复制配置相关手册

* MySQL日志记录格式。主要会介绍```statement based replication (SBR)``` 和 ```row-based replication (RBR)```两种。而第三种混合格式MBR会同时结合前两种的优点。

* 详细介绍不同配置选项和变量对复制所产生的影响

* 一般来说，一旦主从复制建立好之后可以不用再进行管理和监控。但是，还是会介绍一些常用的监控任务执行的方法。


### 1.1 建立MySQL主从复制





<br />
<br />
**[参看]**:


1. [MySQL教程](http://www.runoob.com/mysql/mysql-administration.html)



<br />
<br />
<br />

