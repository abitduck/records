---
layout: post
title: ceph命令总结
tags:
- ceph
categories: ceph
description: ceph命令总结
---

Ceph storage cluster中涉及到大量的命令，在ceph运维的过程中会经常用到。这里对其做一个简单的梳理。ceph命令主要分为一下几大类：

<!-- more -->

* auth命令集
* system命令集
* monitor命令集
* osd命令集
* pg命令集
* mds命令集



## auth命令集
{% highlight string %}
1.  auth add <entity> {<caps> [<caps>...]}   
2.  auth caps <entity> <caps> [<caps>...]    
3.  auth del <entity>                       
4.  auth export {<entity>}                  
5.  auth get <entity>                       
6.  auth get-key <entity>                    
7.  auth get-or-create <entity> {<caps> [<caps>...]}                                                                 
8.  auth get-or-create-key <entity> {<caps> [<caps>...]}                             
9.  auth import                              
10. auth list                                
11. auth print-key <entity>                  
12. auth print_key <entity>                  
{% endhighlight %}

(1) 添加用户身份认证信息

向cephx认证系统中添加用户信息，可以通过文件传入key，或者随机产生。
{% highlight string %}
auth add <entity> {<caps> [<caps>...]}
{% endhighlight %}

例如：
<pre>
sudo ceph auth add osd.0 osd 'allow *' mon 'allow profile osd' -i /var/lib/ceph/osd/ceph-0/keyring
</pre>

(2) 修改用户权限信息

在使用时，一般需要先用```ceph auth get <entity>```或 ```ceph auth export <entity>```来获取到对应实体的权限，然后再进行修改。 
{% highlight string %}
auth caps <entity> <caps> [<caps>...]
{% endhighlight %}

例如：
<pre>
sudo ceph auth caps osd.0 'allow rwx' mon 'allow profile osd'
</pre>

(3) 从cephx系统中删除用户及权限信息

{% highlight string %}
auth del <entity>     
{% endhighlight %}

(4) 导出用户的详细信息（包括用户ID）

从cephx系统中导出用户详细信息，也包括用户ID。可以通过添加```-o```选项来导出到文件

{% highlight string %}
auth export {<entity>} 
{% endhighlight %}

例如：
<pre>
sudo ceph auth export client.admin
</pre>
运行结果如下：

![ceph_auth_export](https://ivanzz1001.github.io/records/assets/img/ceph/command/cmd_auth_export.jpg)



## 2. system命令集


## 3. monitor命令集


## 4. osd命令集

1) 查看当前所有pool
<pre>
# ceph osd pool ls
</pre>


## 5. pg命令集


## 6. mds命令集

## 7. RGW命令集

1) 查看一个pool中的对象数据
<pre>
# rados -p default.rgw.users.uid ls
</pre>

2) 创建swift用户
<pre>
radosgw-admin user create --subuser="registry:swift" --uid="registry" --display-name="registry swift" --key-type=swift --access=full
</pre>

3) rados上传文件
<pre>
# rados put openresty-1.11.2.3.tar.gz ./openresty-1.11.2.3.tar.gz -p nh.rgw.buckets.data
</pre>